# Описание 
Тестовый проект по покрытию автотестами приложения `todo-app`
Проект написан на языке Kotlin с использованием фреймворка JUnit5, библиотек AssertJ, Okhttp и khttp.
Также в проекте реализованн нагрузочный тест с использованием Gatling

## Структура проекта

```bash
├── src
│   ├── main
│   │   ├── kotlin
│   │   │   ├── api
│   │   │   ├── dto
│   │   │   ├── managers
│   │   │   └── utils
│   │   └── resources
│   └── test
│       ├── kotlin
│       │   └── performance
│       └── resources
```
В директории `src/main/kotlin` расположены классы и объекты тестового фреймворка.

В директории `src/test/kotlin` - файлы с функциональными тестами.

В директории `src/test/kotlin/performance` - файлы с нагрузочными тестами.

### Подготовка окружения и запуск тестов 
Запустить тестируемое приложение командой 
```bash
docker run -p 8080:4242 -e VERBOSE=1 todo-app
```

#### Запустить функциональные тесты командой

```bash
 mvn clean test
```
В консоли будет отображен результат запуска: статистика по запущенным/успешным/проваленным тестам.

Также тесты можно запустить из IDEA, статистика выполнения будет более наглядной.

#### Запустить тесты производительности
```bash
 mvn clean gatling:test
```
В консоли будут выведена информация о ходе тестирования, результаты тестирования и ссылка на отчет в формате html.

### Особенности реализации
Сетевые запросы и ответы логируются в консоль.

Реализована очистка тестовых данных после выполнения каждого тестового класса на основе списков созданных todo.

### Известные проблемы
- В общем запуске не проходит тест `checkCreateTodoTest`. Причину исследовать не хватило времени. 
- В логгере не реализован вывод названия метода, вызывающего запись.
- khttp был выбран за простоту использования в результате непродолжительного поиска альтернативных http-клиентов. На этапе имплементации ws-клиента было выяснено, что веб-сокеты khttp не поддерживает, так в проекте появился Okhttp. Для унификации и минимизации количества используемых библиотек класс `ApiClient` целесообразно переписать на Okhttp.

## Обнаруженные дефекты
### Поле id у сущности todo не инкрементируется автоматически

**Описание**

При создании сущности поле id необходимо заполнять на стороне клиента. При отправке запроса на создание todo без поля id возвращается ошибка валидации запроса. 

**Воспроизведение**

Отправить запрос на создание todo с незаполненным полем id
```bash
curl --request POST --location 'http://localhost:8080/todos' \
--header 'Content-Type: application/json' \
--data '{
  "text": "Todo 0",
  "completed": false
}'
```
**ОР**

Сущность создана, в ответе вернулся json с id созданной todo

Пример ответа:
```json
{
  "text": "Todo 0",
  "completed": false,
  "id": 23456
}
```

**ФР**

Сервис отвечает кодом 201 Created с пустым телом ответа. 

### Возможно создание дубликата Todo путем редактирования существующей записи.

**Описание**

Создание todo с одинаковыми id невозможно, попытка проваливается с ошибкой валидации, срабатывает проверка уникальности поля id. При этом возможно отредактировать уже имеющуюся todo и получить дубликаты todo. Покрытие в editTodoDuplicateTest. 

**Воспроизведение**

- Создать две Todo (todo1 и todo2)
- Отправить PUT запрос для редактирования todo1 и id от todo2 в теле запроса.

**ФР**

В списке todo присутствуют две записи с одинаковым id.

**ОР**
 
Ошибка валидации (аналогичная ошибке при попытке создания дубликата todo)

### Некорректный ответ на запрос на редактирование todo с невалидными значениями.
**Описание**

Запрос на редактирование todo с невалидными данными в запросе возвращает ошибку 401.

**Воспроизведение**
- Создать todo
- Отправить запрос на редактирование с невалидными данными (поля со значением null,примеры данных в тесте editTodoValidationTest).
- 
**ФР**

В ответ возвращается код 401 (Unauthorized)

**ОР**

Ответ 400 (Bad request)

**Примечание**

Если добавить в запрос на редактирование заголовок авторизации (аналогично запросу на удаление), по сработает валидация тела запроса и вернется ошибка 400.

## В ответе на запрос GET /todos отсутствуют поля аттрибуты пагинации

**Описание**

В ответе на запрос  GET /todos отсутствуют поля     offset, limit, total, last и first, невозможно оценить общее количество созданных todo.

**Воспроизвение**
 
Создать todo

Отправить запрос на получение списка todo ```GET http://localhost:8080/todos```

**ОР**

Тело ответа будет иметь структуру пагинации с полями    `"content": [],
"offset": 0,
"limit": 100,
"total": 52,
"last": true,
"first": true`

Пример ответа с полями пагинации:
```json
{
"content": [
  {
    "id": 1,
    "text": "Todo 69999",
    "completed": false
  }
],
  "offset": 0,
  "limit": 100,
  "total": 52,
  "last": true,
  "first": true
}
```

**ФР**

Возвращается сериализованный список сущностей без дополнительных полей, оценить общее количество сущностей в сервисе невозможно.
